[General]
bypass-system = true
ipv6 = false
prefer-ipv6 = false
private-ip-answer = true

# --- DNS –ª–æ–≥–∏–∫–∞ ---
dns-direct-system = true
dns-fallback-system = true
dns-direct-fallback-proxy = false

# –û–¥–∏–Ω —Å—Ç–∞–±–∏–ª—å–Ω—ã–π DoH
dns-server = https://dns.adguard-dns.com/dns-query
fallback-dns-server = system

# –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ–±—ã—á–Ω—ã—Ö DNS :53 (–∞–Ω—Ç–∏-—É—Ç–µ—á–∫–∏)
hijack-dns = :53

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å –∏ captive portal –≤—Å–µ–≥–¥–∞ –Ω–∞–ø—Ä—è–º—É—é
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
tun-excluded-routes = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32,239.255.255.250/32

always-real-ip = *
icmp-auto-reply = false
always-reject-url-rewrite = false
udp-policy-not-supported-behaviour = REJECT

# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
update-url = https://cdn.jsdelivr.net/gh/268ry7cgpg-lang/ShadowRocketConfigs@main/sr_geoip.conf


[DNS Policy]
# --- Apple DNS –≤—Å–µ–≥–¥–∞ –Ω–∞–ø—Ä—è–º—É—é (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å iCloud / Push) ---
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Apple/Apple_Resolve.list,DIRECT


[Rule]
# ============================================================
# 0) APPLE –°–¢–†–û–ì–û –ù–ê–ü–†–Ø–ú–£–Æ
# ============================================================
DOMAIN-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Apple/Apple_Domain.list,DIRECT
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Apple/Apple.list,DIRECT


# ============================================================
# 1) –†–û–°–°–ò–ô–°–ö–ò–ï –î–û–ú–ï–ù–´ ‚Äî –ù–ê–ü–†–Ø–ú–£–Æ
# ============================================================
DOMAIN-SUFFIX,ru,DIRECT
DOMAIN-SUFFIX,—Ä—Ñ,DIRECT
DOMAIN-SUFFIX,su,DIRECT
DOMAIN-SUFFIX,moscow,DIRECT


# ============================================================
# 2) –°–ï–†–í–ò–°–´ –° force-remote-dns (CDN + –∞–Ω—Ç–∏-–¥–µ—Ç–µ–∫—Ç)
# ============================================================

# --- –û—Ç–∫–ª—é—á–∞–µ–º QUIC / HTTP3 (—á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –∏ Gemini / Meta) ---
AND,((PROTOCOL,UDP),(DEST-PORT,443)),REJECT


# ü§ñ ChatGPT / OpenAI
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/OpenAI/OpenAI.list,PROXY,force-remote-dns


# üì∏ Meta (Instagram / Facebook / WhatsApp)
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Instagram/Instagram.list,PROXY,force-remote-dns
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Facebook/Facebook.list,PROXY,force-remote-dns
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/WhatsApp/WhatsApp.list,PROXY,force-remote-dns


# üéµ Spotify
RULE-SET,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Shadowrocket/Spotify/Spotify.list,PROXY,force-remote-dns


# ============================================================
# 3) RU IP
# ============================================================
GEOIP,RU,DIRECT


# ============================================================
# 4) –í–°–Å –û–°–¢–ê–õ–¨–ù–û–ï ‚Äî –ß–ï–†–ï–ó PROXY
# ============================================================
FINAL,PROXY
